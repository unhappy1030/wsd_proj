<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="crecipe">
    <insert id="insertCRecipe" parameterType="org.example.wsd_proj.VO.CRecipe" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO crecipes (
        user_id,
        recipe_name,
        cooking_method,
        dish_type,
        ingredients,
        hash_tag,
        low_sodium_tip,
        main_image_path
        ) VALUES (
        #{userId},
        #{recipeName},
        #{cookingMethod},
        #{dishType},
        #{ingredients},
        #{hashTag},
        #{lowSodiumTip},
        #{mainImagePath}
        )
    </insert>

    <insert id="insertCNutrition" parameterType="org.example.wsd_proj.VO.CNutrition">
        INSERT INTO cnutrition_info (
        recipe_id,
        weight,
        calories,
        carbohydrates,
        protein,
        fat,
        sodium
        ) VALUES (
        #{recipeId},
        #{weight},
        #{calories},
        #{carbohydrates},
        #{protein},
        #{fat},
        #{sodium}
        )
    </insert>

    <insert id="insertCManualSteps" parameterType="java.util.List">
        INSERT INTO cmanual_steps (
        recipe_id,
        step_order,
        step_description,
        step_image_path
        )
        VALUES
        <foreach collection="list" item="manual" separator=",">
            (
            #{manual.recipeId},
            #{manual.stepOrder},
            #{manual.stepDescription},
            #{manual.stepImagePath}
            )
        </foreach>
    </insert>

    <select id="selectAllRecipes" resultType="org.example.wsd_proj.VO.CRecipe">
        SELECT * FROM crecipes;
    </select>

    <select id="selectCRecipeById" parameterType="int" resultType="org.example.wsd_proj.VO.CRecipe">
        SELECT * FROM crecipes WHERE id = #{id};
    </select>
    <select id="selectCNutritionById" parameterType="int" resultType="org.example.wsd_proj.VO.CNutrition">
        SELECT * FROM cnutrition_info WHERE recipe_id = #{id};
    </select>
    <select id="selectCManualById" parameterType="int" resultType="org.example.wsd_proj.VO.CManual">
        SELECT * FROM cmanual_steps WHERE recipe_id = #{id} ORDER BY step_order;
    </select>

    <delete id="deleteCRecipeById" parameterType="map">
        DELETE FROM crecipes
        WHERE id = #{id} AND user_id = #{userId}
    </delete>
    <delete id="deleteCNutritionInfoById" parameterType="int">
        DELETE FROM cnutrition_info
        WHERE recipe_id = #{id}
    </delete>
    <delete id="deleteCManualStepsById" parameterType="int">
        DELETE FROM cmanual_steps
        WHERE recipe_id = #{id}
    </delete>
</mapper>

